{"Parameters":{"AWSEBDBUser":"root","AWSEBDBPassword":"ucanapply123","InstanceType":"t1.micro"},"TemplateExtensions":{"EnvironmentInfoBase":{"ElementMappings":{},"SourceLocation":null,"Order":3,"SnippetContents":{"Parameters":{"LogPublicationControl":{"Default":"false","AllowedValues":["true","false"],"Description":"If true customer service logs will be published to S3.","Type":"String","ConstraintDescription":"must be Boolean."}},"Mappings":{"EnvironmentInfoTasks":{"systemtail":{"AutoClean":"true","CommandName":"CMD-SystemTailLogs","LocationPrefix":"resources\/environments\/logs\/systemtail\/"},"bundle":{"CommandName":"CMD-BundleLogs","LocationPrefix":"resources\/environments\/logs\/bundle\/"},"publish":{"LocationPrefix":"resources\/environments\/logs\/publish\/"},"tail":{"AutoClean":"true","CommandName":"CMD-TailLogs","LocationPrefix":"resources\/environments\/logs\/tail\/"}}},"Resources":{"AWSEBAutoScalingGroup":{"Metadata":{"AWS::ElasticBeanstalk::Ext":{"_EnvironmentInfoTaskMapping":{"CmpFn::Ref":"Mapping.EnvironmentInfoTasks"},"_ParameterTriggers":{"_TriggerConfigDeployment":{"CmpFn::Insert":{"values":["LogPublicationControl"]}}},"_ContainerConfigFileContent":{"system":{"LogPublicationControl":{"Ref":"LogPublicationControl"},"AWSEBReferrerId":{"Ref":"AWSEBReferrerId"},"AWSEBAgentId":{"Ref":"AWSEBAgentId"}}},"_API":{"_Commands":{"CMD-BundleLogs":{"_Stages":{"01_enact":{"CmpFn::Insert":{"values":["InfoTask-BundleLogs"]}}}},"CMD-SystemTailLogs":{"_Stages":{"01_enact":{"CmpFn::Insert":{"values":["InfoTask-SystemTailLogs"]}}}},"CMD-TailLogs":{"_Stages":{"01_enact":{"CmpFn::Insert":{"values":["InfoTask-TailLogs"]}}}}}}},"AWS::CloudFormation::Init":{"Infra-WritePublishLogsCron":{"files":{"\/etc\/cron.d\/publishlogs":{"content":{"Fn::Join":["",["SHELL=\/bin\/bash","\n","PATH=\/sbin:\/bin:\/usr\/sbin:\/usr\/bin","\n","MAILTO=root","\n","HOME=\/","\n","10,30,50 * * * * root ","publishLogs.py --de-dupe --conf-path '\/opt\/elasticbeanstalk\/tasks\/publishlogs.d\/*' --location-prefix ",{"Fn::FindInMap":[{"CmpFn::Ref":"Mapping.EnvironmentInfoTasks"},"publish","LocationPrefix"]}," --num-concurrent 2","\n","05,25,45 * * * * root ","clearStaleLogPublishingRecords.py","\n"]]},"mode":"000644"}}},"Infra-WriteBundleLogsConf":{"files":{"\/opt\/elasticbeanstalk\/tasks\/bundlelogs.d\/eb-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/eb-cfn-hup-call*","\/var\/log\/eb-cfn-init-call*","\/var\/log\/eb-cfn-init*","\/var\/log\/eb-tools*","\/var\/log\/eb-publish-logs*",""]]},"mode":"000644"},"\/opt\/elasticbeanstalk\/tasks\/bundlelogs.d\/cfn-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/cfn-hup*","\/var\/log\/cfn-init*",""]]},"mode":"000644"},"\/opt\/elasticbeanstalk\/tasks\/bundlelogs.d\/cloud-init-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/cloud-init*",""]]},"mode":"000644"},"\/opt\/elasticbeanstalk\/tasks\/bundlelogs.d\/system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/cron","\/var\/log\/messages","\/var\/log\/yum.log",""]]},"mode":"000644"}}},"configSets":{"Infra-WritePublishLogsCron":["Infra-WritePublishLogsCron"],"_OnInstanceBoot":{"CmpFn::Insert":{"values":["Infra-WriteTailLogsConf","Infra-WriteSystemTailLogsConf","Infra-WriteBundleLogsConf","Infra-WritePublishLogsConf","Infra-WritePublishLogsCron"]}},"Infra-WriteBundleLogsConf":["Infra-WriteBundleLogsConf"],"InfoTask-SystemTailLogs":["InfoTask-SystemTailLogs"],"Infra-WriteTailLogsConf":["Infra-WriteTailLogsConf"],"InfoTask-TailLogs":["InfoTask-TailLogs"],"Infra-WritePublishLogsConf":["Infra-WritePublishLogsConf"],"InfoTask-BundleLogs":["InfoTask-BundleLogs"],"Infra-WriteSystemTailLogsConf":["Infra-WriteSystemTailLogsConf"]},"InfoTask-SystemTailLogs":{"commands":{"systemtaillogs":{"command":{"Fn::Join":["",["tailLogs.py --conf-path '\/opt\/elasticbeanstalk\/tasks\/systemtaillogs.d\/*' --location-prefix ",{"Fn::FindInMap":[{"CmpFn::Ref":"Mapping.EnvironmentInfoTasks"},"systemtail","LocationPrefix"]}]]}}}},"Infra-WriteTailLogsConf":{"files":{"\/opt\/elasticbeanstalk\/tasks\/taillogs.d\/cfn-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/cfn-hup.log","\/var\/log\/cfn-init.log",""]]},"mode":"000644"},"\/opt\/elasticbeanstalk\/tasks\/taillogs.d\/eb-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/eb-cfn-hup-call.log","\/var\/log\/eb-cfn-init-call.log","\/var\/log\/eb-cfn-init.log","\/var\/log\/eb-tools.log","\/var\/log\/eb-publish-logs.log",""]]},"mode":"000644"}}},"Infra-WritePublishLogsConf":{"files":{}},"InfoTask-TailLogs":{"commands":{"taillogs":{"command":{"Fn::Join":["",["tailLogs.py --concatenate --conf-path '\/opt\/elasticbeanstalk\/tasks\/taillogs.d\/*' --location-prefix ",{"Fn::FindInMap":[{"CmpFn::Ref":"Mapping.EnvironmentInfoTasks"},"tail","LocationPrefix"]}]]}}}},"InfoTask-BundleLogs":{"commands":{"bundlelogs":{"command":{"Fn::Join":["",["bundleLogs.py --conf-path '\/opt\/elasticbeanstalk\/tasks\/bundlelogs.d\/*' --location-prefix ",{"Fn::FindInMap":[{"CmpFn::Ref":"Mapping.EnvironmentInfoTasks"},"bundle","LocationPrefix"]}]]}}}},"Infra-WriteSystemTailLogsConf":{"files":{"\/opt\/elasticbeanstalk\/tasks\/systemtaillogs.d\/eb-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/eb-cfn-hup-call.log","\/var\/log\/eb-cfn-init-call.log","\/var\/log\/eb-cfn-init.log","\/var\/log\/eb-tools.log","\/var\/log\/eb-publish-logs.log",""]]},"mode":"000644"},"\/opt\/elasticbeanstalk\/tasks\/systemtaillogs.d\/system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/cron","\/var\/log\/messages","\/var\/log\/yum.log",""]]},"mode":"000644"},"\/opt\/elasticbeanstalk\/tasks\/systemtaillogs.d\/cloud-init-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/cloud-init.log",""]]},"mode":"000644"},"\/opt\/elasticbeanstalk\/tasks\/systemtaillogs.d\/cfn-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/cfn-hup.log","\/var\/log\/cfn-init.log",""]]},"mode":"000644"}}}}}}}}},"EbBase":{"ElementMappings":{},"SourceLocation":null,"Order":1,"SnippetContents":{"Parameters":{"AWSEBReferrerId":{"Default":"","Type":"String"},"AWSEBEnvironmentId":{"Type":"String"},"AWSEBAgentId":{"Default":"","Type":"String"},"AWSEBEnvironmentName":{"Type":"String"},"AWSEBEnvironmentBucket":{"Type":"String"}},"Mappings":{"AWSEBOptions":{"options":{"UserDataScript":"","nodeploymentOnStartup":"true","ebrpm":"","cfnrpm":""}}},"Resources":{"AWSEBInstanceLaunchWaitCondition":{"Type":"AWS::CloudFormation::WaitCondition","DependsOn":"AWSEBAutoScalingGroup","Properties":{"Handle":{"Ref":{"CmpFn::Ref":"Resource.AWSEBInstanceLaunchWaitHandle"}},"Timeout":"600"}},"AWSEBAutoScalingLaunchConfiguration":{"Properties":{"UserData":{"Fn::Base64":{"Fn::Join":["",["Content-Type: multipart\/mixed; boundary=\"===============5189065377222898407==\"","\n","MIME-Version: 1.0","\n","","\n","--===============5189065377222898407==","\n","Content-Type: text\/cloud-config; charset=\"us-ascii\"","\n","MIME-Version: 1.0","\n","Content-Transfer-Encoding: 7bit","\n","Content-Disposition: attachment; filename=\"cloud-config.txt\"","\n","","\n","#cloud-config","\n","repo_upgrade: none","\n","repo_releasever: 2012.09","\n","","\n","--===============5189065377222898407==","\n","Content-Type: text\/x-shellscript; charset=\"us-ascii\"","\n","MIME-Version: 1.0","\n","Content-Transfer-Encoding: 7bit","\n","Content-Disposition: attachment; filename=\"user-data.txt\"","\n\n","#!\/bin\/bash","\n","exec > >(tee -a \/var\/log\/eb-cfn-init.log|logger -t [eb-cfn-init] -s 2>\/dev\/console) 2>&1","\n","set -x","\n","\n\n","function sleep_delay ","\n","{","\n","  if (( $SLEEP_TIME < $SLEEP_TIME_MAX )); then ","\n","    echo Sleeping $SLEEP_TIME","\n","    sleep $SLEEP_TIME  ","\n","    $SLEEP_TIME=$(($SLEEP_TIME * 2)) ","\n","  else ","\n","    echo Sleeping $SLEEP_TIME_MAX  ","\n","    sleep $SLEEP_TIME_MAX  ","\n","  fi","\n","}","\n\n","# Executing bootstrap script","\n","SLEEP_TIME=10","\n","SLEEP_TIME_MAX=3600","\n","while true; do ","\n","  curl ",{"Fn::FindInMap":["AWSEBOptions","options","UserDataScript"]}," > \/tmp\/ebbootstrap.sh ","\n","  RESULT=$?","\n","  if [[ \"$RESULT\" -ne 0 ]]; then ","\n","    sleep_delay ","\n","  else","\n","    \/bin\/bash \/tmp\/ebbootstrap.sh ","    '",{"Fn::FindInMap":["AWSEBOptions","options","requests"]},"'","    '",{"Fn::FindInMap":["AWSEBOptions","options","cfnrpm"]},"'","    '",{"Ref":{"CmpFn::Ref":"Resource.AWSEBInstanceLaunchWaitHandle"}},"'","    '",{"Ref":"AWS::StackId"},"'","    '",{"Ref":"AWS::Region"},"'","    & ","\n","    exit 0  ","\n","  fi ","\n","done","\n\n","--===============5189065377222898407==-- "]]}}}},"AWSEBAutoScalingGroup":{"Metadata":{"AWS::CloudFormation::Init":{"configSets":{"_OnInstanceBoot":["AWSEBTools","AWSEBBaseConfig","AWSEBCfnHup"],"_OnInstanceReboot":["AWSEBTools","AWSEBBaseConfig","AWSEBCfnHup"]},"AWSEBTools":{"packages":{"python":{"requests":"0.13.5","tailer":"0.3"},"rpm":{"aws-elasticbeanstalk-tools":{"Fn::FindInMap":["AWSEBOptions","options","ebrpm"]}}}},"AWSEBBaseConfig":{"files":{"\/etc\/cfn\/hooks.d\/aws-eb-command-handler.conf":{"content":{"Fn::Join":["",["[aws-eb-command-handler]","\n","triggers=on.command","\n","path=ElasticBeanstalkCommand-",{"CmpFn::Ref":"Resource.AWSEBAutoScalingGroup"},"\n","action=commandWrapper.py","\n"]]}},"\/etc\/cfn\/cfn-hup.conf":{"content":{"Fn::Join":["",["[main]","\n","stack=",{"Ref":"AWS::StackId"},"\n","region=",{"Ref":"AWS::Region"},"\n"]]},"owner":"root","group":"root","mode":"000400"},"\/etc\/elasticbeanstalk\/.aws-eb-stack.properties":{"content":{"Fn::Join":["",["environment_id=",{"Ref":"AWSEBEnvironmentId"},"\n","environment_bucket=",{"Ref":"AWSEBEnvironmentBucket"},"\n","stack_name=",{"Ref":"AWS::StackId"},"\n","resource=",{"CmpFn::Ref":"Resource.AWSEBAutoScalingGroup"},"\n","region=",{"Ref":"AWS::Region"},"\n\n"]]},"owner":"root","group":"root","mode":"000440"}},"commands":{"clearbackupfiles":{"command":"rm -f \/etc\/cfn\/hooks.d\/*.bak"}}},"AWSEBCfnHup":{"services":{"sysvinit":{"cfn-hup":{"ensureRunning":"true"}}}}}},"DependsOn":"AWSEBBeanstalkMetadata","Properties":{"Tags":[{"PropagateAtLaunch":true,"Value":{"Ref":{"CmpFn::Ref":"Parameter.AWSEBEnvironmentName"}},"Key":"elasticbeanstalk:environment-name"},{"PropagateAtLaunch":true,"Value":{"Ref":{"CmpFn::Ref":"Parameter.AWSEBEnvironmentName"}},"Key":"Name"},{"PropagateAtLaunch":true,"Value":{"Ref":{"CmpFn::Ref":"Parameter.AWSEBEnvironmentId"}},"Key":"elasticbeanstalk:environment-id"}]}},"AWSEBInstanceLaunchWaitHandle":{"Type":"AWS::CloudFormation::WaitConditionHandle"},"AWSEBBeanstalkMetadata":{"Type":"AWS::CloudFormation::WaitConditionHandle"}}}},"PHPBeanstalk":{"ElementMappings":{},"SourceLocation":null,"Order":10000,"SnippetContents":{"Parameters":{"DocumentRoot":{"Default":"","Description":"Enables you to specify the child directory of your project that is treated as the public-facing web root. If your root document is stored in your project directory, leave this set to \"\/\". If your root document is inside a child directory (e.g., <project>\/public), set this value to match the child directory. Values should begin with a \"\/\" character, and may NOT begin with a \".\" character.","Type":"String"},"InstancePort":{"Default":"80","Description":"Listen Port","Type":"String"},"DisplayErrors":{"Default":"Off","Description":"Specifies whether error messages should be part of the output. (This value is written to the php.ini file.)","Type":"String"},"MaxExecutionTime":{"Default":60,"Description":"Sets the maximum time, in seconds, a script is allowed to run before it is terminated by the environment. This helps prevent poorly written scripts from tying up the server.","Type":"Number"},"ZlibOutputCompression":{"Default":"Off","Description":"Specifies whether PHP should use compression for output. (This value is written to the php.ini file.)","Type":"String"},"AppSource":{"Default":"https:\/\/s3-ap-southeast-1.amazonaws.com\/elasticbeanstalk-samples-ap-southeast-1\/php-newsample-app.zip","Description":"The url of the application source.","Type":"String"},"AllowUrlFopen":{"Default":"On","Description":"Specifies whether the PHP's file functions are allowed to retrieve data from remote locations, such as websites or FTP servers. (This value is written to the php.ini file.)","Type":"String"},"ComposerOptions":{"Default":"","Description":"Sets custom options to use when installing dependencies using Composer through composer.phar install","Type":"String"},"EnvironmentVariables":{"Default":"AWS_ACCESS_KEY_ID=,AWS_SECRET_KEY=,PARAM1=,PARAM2=,PARAM3=,PARAM4=,PARAM5=","Description":"Program environment variables.","Type":"CommaDelimitedList"},"MemoryLimit":{"Default":"256M","Description":"Specifies the amount of memory allocated to the PHP environment. (This value is written to the php.ini file.)","Type":"String"}},"Mappings":{"AWSEBOptions":{"options":{"DefaultsScript":"\/opt\/elasticbeanstalk\/support\/cfncontext.rb"}}},"Resources":{"AWSEBLoadBalancer":{"Properties":{"Listeners":{"CmpFn::Insert":{"values":[{"LoadBalancerPort":"80","InstancePort":{"Ref":"InstancePort"},"Protocol":"HTTP"}]}},"HealthCheck":{"Target":{"Fn::Join":["",["TCP",":",{"Ref":"InstancePort"}]]}}}},"AWSEBAutoScalingGroup":{"Metadata":{"AWS::ElasticBeanstalk::Ext":{"_ParameterTriggers":{"_TriggerConfigDeployment":{"CmpFn::Insert":{"values":["InstancePort","EnvironmentVariables","DocumentRoot","MemoryLimit","ZlibOutputCompression","AllowUrlFopen","DisplayErrors","MaxExecutionTime","ComposerOptions"]}}},"_ContainerConfigFileContent":{"php":{"env":{"Ref":"EnvironmentVariables"}},"env":{"PHP_MAX_EXECUTION_TIME":{"Ref":"MaxExecutionTime"},"PHP_DISPLAY_ERRORS":{"Ref":"DisplayErrors"},"PHP_DOCUMENT_ROOT":{"Ref":"DocumentRoot"},"PHP_ALLOW_URL_FOPEN":{"Ref":"AllowUrlFopen"},"PHP_MEMORY_LIMIT":{"Ref":"MemoryLimit"},"PHP_ZLIB_OUTPUT_COMPRESSION":{"Ref":"ZlibOutputCompression"},"PHP_COMPOSER_OPTIONS":{"Ref":"ComposerOptions"}},"http_port":{"Ref":"InstancePort"},"document_root":{"Ref":"DocumentRoot"}}},"AWS::CloudFormation::Init":{"configSets":{"_OnInstanceBoot":{"CmpFn::Insert":{"values":["InstallAssets"],"subscript":0}}},"InstallAssets":{"sources":{"\/opt\/elasticbeanstalk":"https:\/\/elasticbeanstalk-env-resources-ap-southeast-1.s3.amazonaws.com\/eb_php\/v1.5\/assets-php-5.4-64bit.tar.gz"}}}}},"AWSEBSecurityGroup":{"Properties":{"SecurityGroupIngress":{"CmpFn::Insert":{"values":[{"IpProtocol":"tcp","SourceSecurityGroupName":{"Fn::GetAtt":["AWSEBLoadBalancer","SourceSecurityGroup.GroupName"]},"ToPort":{"Ref":"InstancePort"},"SourceSecurityGroupOwnerId":{"Fn::GetAtt":["AWSEBLoadBalancer","SourceSecurityGroup.OwnerAlias"]},"FromPort":{"Ref":"InstancePort"}}]}}}}}}},"System-ContainerRuntime":{"ElementMappings":{},"SourceLocation":null,"Order":30,"SnippetContents":{"Resources":{"AWSEBAutoScalingGroup":{"Metadata":{"AWS::CloudFormation::Init":{"Hook-EnactAppDeploy":{"files":{"\/etc\/httpd\/conf.d\/01ebsys.conf":{"content":{"Fn::Join":["\n",["<Directory ~ \".*\\.ebextensions\">","Order Deny,Allow","Deny from All","<\/Directory>"]]}}},"commands":{"clean":{"command":"rm -f \/etc\/httpd\/conf.d\/01ebsys.conf.*"},"aclean":{"command":"rm -rf \/opt\/python\/ondeck\/app\/.ebextensions\/; rm -rf \/var\/app\/ondeck\/.ebextensions\/"}}}}}}}}},"RDS":{"ElementMappings":{},"SourceLocation":"https:\/\/s3.amazonaws.com\/elasticbeanstalk-env-resources-ap-southeast-1\/eb_snippets\/rds\/rds.json","Order":null,"SnippetContents":{"Outputs":{"AWSEBRDSDatabaseProperties":{"Value":{"Fn::Join":[",",[{"Ref":"AWSEBRDSDatabase"},{"Fn::GetAtt":["AWSEBRDSDatabase","Endpoint.Address"]},{"Fn::GetAtt":["AWSEBRDSDatabase","Endpoint.Port"]}]]},"Description":"Properties associated with the RDS database instance"}},"Parameters":{"AWSEBDBUser":{"Default":"ebroot","NoEcho":"true","Description":"The name of master user for the client DB Instance.","Type":"String","ConstraintDescription":"must begin with a letter and contain only alphanumeric characters"},"AWSEBDBName":{"Default":"ebdb","NoEcho":"true","Description":"The DB Name of the RDS instance","Type":"String","ConstraintDescription":"must contain only alphanumeric characters"},"AWSEBDBPassword":{"NoEcho":"true","Description":"The master password for the DB instance.","Type":"String","ConstraintDescription":"must contain only alphanumeric characters"}},"SnippetMetadata":{"Documentation":"RDS Snippet for AWS ElasticBeanStalk","Description":"RDS Snippet","Version":"1.0"},"Resources":{"AWSEBRDSDBSecurityGroup":{"Type":"AWS::RDS::DBSecurityGroup","Properties":{"GroupDescription":"Enable database access to Beanstalk application","DBSecurityGroupIngress":{"EC2SecurityGroupName":{"Ref":"AWSEBSecurityGroup"}}}},"AWSEBRDSDatabase":{"Type":"AWS::RDS::DBInstance","DeletionPolicy":"Delete","Properties":{"MasterUsername":{"Ref":{"CmpFn::Ref":"Parameter.AWSEBDBUser"}},"DBSecurityGroups":[{"Ref":"AWSEBRDSDBSecurityGroup"}],"DBInstanceClass":"db.t1.micro","AllocatedStorage":"5","MultiAZ":false,"EngineVersion":"5.5","DBName":{"Ref":{"CmpFn::Ref":"Parameter.AWSEBDBName"}},"MasterUserPassword":{"Ref":{"CmpFn::Ref":"Parameter.AWSEBDBPassword"}},"Engine":"mysql"}},"AWSEBAutoScalingGroup":{"Metadata":{"AWS::ElasticBeanstalk::Ext":{"_ParameterTriggers":{"_TriggerConfigDeployment":{"CmpFn::Insert":{"values":[{"CmpFn::Ref":"Parameter.AWSEBDBUser"},{"CmpFn::Ref":"Parameter.AWSEBDBPassword"},{"CmpFn::Ref":"Parameter.AWSEBDBName"}]}}},"_ContainerConfigFileContent":{"plugins":{"rds":{"Description":"RDS Environment variables","env":{"RDS_PORT":{"Fn::GetAtt":["AWSEBRDSDatabase","Endpoint.Port"]},"RDS_USERNAME":{"Ref":{"CmpFn::Ref":"Parameter.AWSEBDBUser"}},"RDS_DB_NAME":{"Ref":{"CmpFn::Ref":"Parameter.AWSEBDBName"}},"RDS_PASSWORD":{"Ref":{"CmpFn::Ref":"Parameter.AWSEBDBPassword"}},"RDS_HOSTNAME":{"Fn::GetAtt":["AWSEBRDSDatabase","Endpoint.Address"]}}}}}}}}}}},"RpmLocation":{"ElementMappings":{},"SourceLocation":null,"Order":4,"SnippetContents":{"Mappings":{"AWSEBOptions":{"options":{"UserDataScript":"https:\/\/s3-ap-southeast-1.amazonaws.com\/elasticbeanstalk-env-resources-ap-southeast-1\/stalks\/eb_hooks_base_1.4\/lib\/UserDataScript.sh","requests":"https:\/\/s3-ap-southeast-1.amazonaws.com\/elasticbeanstalk-env-resources-ap-southeast-1\/stalks\/eb_hooks_base_1.4\/lib\/requests-0.13.5.tar.gz#md5=805fd122b4cfd224e15ff2f5288c5ba0","ebrpm":"https:\/\/s3-ap-southeast-1.amazonaws.com\/elasticbeanstalk-env-resources-ap-southeast-1\/stalks\/eb_hooks_base_1.4\/lib\/aws-elasticbeanstalk-tools-1.5-1.noarch.rpm","cfnrpm":"https:\/\/s3-ap-southeast-1.amazonaws.com\/elasticbeanstalk-env-resources-ap-southeast-1\/stalks\/eb_hooks_base_1.4\/lib\/python-certifi-0.0.8-2.3.amzn1.noarch.rpm https:\/\/s3-ap-southeast-1.amazonaws.com\/elasticbeanstalk-env-resources-ap-southeast-1\/stalks\/eb_hooks_base_1.4\/lib\/aws-cfn-bootstrap-1.3-6.noarch.rpm"}}},"Resources":{"AWSEBAutoScalingGroup":{"Metadata":{"AWS::CloudFormation::Init":{"AWSEBTools":{"packages":{"python":{"tailer":"https:\/\/s3-ap-southeast-1.amazonaws.com\/elasticbeanstalk-env-resources-ap-southeast-1\/stalks\/eb_hooks_base_1.4\/lib\/tailer-0.3.tar.gz#md5=9d1fc073e48ca682786d50c077e823ce"}}}}}}}}},"HooksContainer":{"ElementMappings":{},"SourceLocation":null,"Order":2,"SnippetContents":{"Parameters":{"AppSource":{"Default":"","Description":"Application Source","Type":"String"}},"Mappings":{"AWSEBOptions":{"options":{"LeaderTestScript":"\/opt\/elasticbeanstalk\/bin\/leader-test.sh","LaunchType":"Migration","EmbeddedConfigsetsEnabled":"true"}}},"Resources":{"AWSEBAutoScalingGroup":{"Metadata":{"AWS::ElasticBeanstalk::Ext":{"_TriggersConfig":{"applicationDeploy":{"_Command":"CMD-AppDeploy","_WatchGroups":["_TriggerAppDeployment"]},"configDeploy":{"_Command":"CMD-ConfigDeploy","_WatchGroups":["_TriggerConfigDeployment"]}},"_ParameterTriggers":{"_TriggerAppDeployment":[{"CmpFn::Ref":"Parameter.AppSource"}],"_TriggerConfigDeployment":[]},"_ContainerConfigFileContent":{},"_API":{"_Commands":{"CMD-ConfigDeploy":{"_Stages":{"02_enact":{"CmpFn::Insert":{"values":["Hook-EnactConfigDeploy","Hook-PostConfigDeploy"]}},"01_pre":{"CmpFn::Insert":{"values":["Infra-WriteRuntimeConfig","Hook-PreConfigDeploy"]}}},"_RunStaged":"true"},"CMD-RestartAppServer":{"_Stages":{"02_enact":{"CmpFn::Insert":{"values":["Hook-EnactRestartAppServer","Hook-PostRestartAppServer"]}},"01_enact":{"CmpFn::Insert":{"values":["Infra-WriteRuntimeConfig","Hook-PreRestartAppServer"]}}},"_RunStaged":"false"},"CMD-Startup":{"_Stages":{"02_enact":{"CmpFn::Insert":{"values":["Hook-EnactAppDeploy","Hook-PostAppDeploy","Hook-PostInit","Infra-WriteVersionOnStartup"]}},"01_pre":{"CmpFn::Insert":{"values":["Infra-EmbeddedPreBuild","Hook-PreAppDeploy","Infra-EmbeddedPostBuild"]}}},"_RunStaged":"true"},"CMD-AppDeploy":{"_Stages":{"02_enact":{"CmpFn::Insert":{"values":["Hook-EnactAppDeploy","Hook-PostAppDeploy"]}},"01_pre":{"CmpFn::Insert":{"values":["Infra-WriteRuntimeConfig","Infra-WriteApplication1","Infra-WriteApplication2","Infra-EmbeddedPreBuild","Hook-PreAppDeploy","Infra-EmbeddedPostBuild"]}}},"_RunStaged":"true"}}},"_AppSourceUrlFileContent":{"url":{"Ref":{"CmpFn::Ref":"Parameter.AppSource"}}}},"AWS::CloudFormation::Init":{"Infra-WriteApplication1":{"commands":{"01mkdir":{"command":"rm -rf \/opt\/elasticbeanstalk\/deploy\/appsource\/; mkdir -p \/opt\/elasticbeanstalk\/deploy\/appsource\/"}}},"Infra-WriteApplication2":{"files":{"\/opt\/elasticbeanstalk\/deploy\/appsource\/source_bundle":{"source":{"Ref":{"CmpFn::Ref":"Parameter.AppSource"}}}}},"Hook-PostConfigDeploy":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/configdeploy\/post\/"}}},"Hook-EnactAppDeploy":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/appdeploy\/enact\/"}}},"Hook-PreConfigDeploy":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/configdeploy\/pre\/"}}},"Hook-EnactConfigDeploy":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/configdeploy\/enact\/"}}},"Infra-WriteVersionOnStartup":{"commands":{"01writeversion":{"command":"getMetadata.py --resource AWSEBBeanstalkMetadata --path AWS::ElasticBeanstalk::Metadata.Version > \/etc\/elasticbeanstalk\/.aws-eb-startup-version"}}},"Hook-PreAppDeploy":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/appdeploy\/pre\/"}}},"Hook-PostInit":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/postinit\/"}}},"configSets":{"Infra-WriteApplication1":["Infra-WriteApplication1"],"_OnInstanceBoot":{"CmpFn::Insert":{"values":["Infra-WriteLeaderTestScript","Infra-WriteRuntimeConfig","Infra-WriteApplication1","Infra-WriteApplication2"]}},"Infra-EmbeddedPostBuild":[],"Infra-WriteApplication2":["Infra-WriteApplication2"],"Hook-PostConfigDeploy":["Hook-PostConfigDeploy"],"_AppInstall":["Hook-PreInit","Hook-PreAppDeploy","Hook-EnactAppDeploy","Hook-PostAppDeploy","Hook-PostInit"],"_OnInstanceReboot":{"CmpFn::Insert":{"values":["Infra-WriteRuntimeConfig","Infra-WriteApplication1","Infra-WriteApplication2"]}},"Hook-EnactAppDeploy":["Hook-EnactAppDeploy"],"Hook-PreConfigDeploy":["Hook-PreConfigDeploy"],"Hook-EnactConfigDeploy":["Hook-EnactConfigDeploy"],"Infra-EmbeddedPreBuild":[],"Infra-WriteVersionOnStartup":["Infra-WriteVersionOnStartup"],"Hook-PreAppDeploy":["Hook-PreAppDeploy"],"Hook-PostInit":["Hook-PostInit"],"Hook-PostAppDeploy":["Hook-PostAppDeploy"],"Hook-PreRestartAppServer":["Hook-PreRestartAppServer"],"Hook-EnactRestartAppServer":["Hook-EnactRestartAppServer"],"_AppInstallReboot":["Hook-PreAppDeploy"],"Infra-WriteRuntimeConfig":["Infra-WriteRuntimeConfig"],"Hook-PostRestartAppServer":["Hook-PostRestartAppServer"],"Hook-PreInit":["Hook-PreInit"]},"Infra-WriteLeaderTestScript":{"files":{"\/opt\/elasticbeanstalk\/bin\/leader-test.sh":{"content":{"Fn::Join":["",["#!\/bin\/bash","\n","if [[ \"$EB_IS_COMMAND_LEADER\" == \"true\" ]]; then ","\n","  exit 0 ","\n","else  ","\n","  exit 1 ","\n","fi ","\n"]]},"mode":"000755"}}},"Hook-PostAppDeploy":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/appdeploy\/post\/"}}},"Hook-PreRestartAppServer":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/restartappserver\/pre\/"}}},"Hook-EnactRestartAppServer":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/restartappserver\/enact\/"}}},"Hook-PostRestartAppServer":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/restartappserver\/post\/"}}},"Infra-WriteRuntimeConfig":{"commands":{"02writeappsource":{"command":{"Fn::Join":["",["getMetadata.py --path AWS::ElasticBeanstalk::Ext._AppSourceUrlFileContent > \/opt\/elasticbeanstalk\/deploy\/configuration\/appsourceurl"]]}},"03writeconfig":{"command":{"Fn::Join":["",["getMetadata.py --path AWS::ElasticBeanstalk::Ext._ContainerConfigFileContent > \/opt\/elasticbeanstalk\/deploy\/configuration\/containerconfiguration"]]}},"01mkdir":{"command":"rm -rf \/opt\/elasticbeanstalk\/deploy\/configuration; mkdir -p \/opt\/elasticbeanstalk\/deploy\/configuration"},"04setperms":{"command":"\/bin\/chmod og-rwx \/opt\/elasticbeanstalk\/deploy\/configuration\/containerconfiguration"}}},"Hook-PreInit":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/preinit\/"}}}}}}}}}},"TemplatePackVersion":"1.0","BaseTemplate":{"SourceLocation":null,"TemplateContents":{"Outputs":{"AWSEBLoadBalancerURL":{"Value":{"Fn::Join":["",["http:\/\/",{"Fn::GetAtt":["AWSEBLoadBalancer","DNSName"]}]]},"Description":"The ElasticBeanstalk ELB URL of the website"}},"Parameters":{"InstanceType":{"Default":"t1.micro","AllowedValues":["t1.micro","m1.small","m1.medium","m1.large","m1.xlarge","c1.medium","c1.xlarge","m2.xlarge","m2.2xlarge","m2.4xlarge"],"Description":"WebServer EC2 instance type","Type":"String","ConstraintDescription":"must be a valid EC2 instance type."}},"Mappings":{"AWSEBOptions":{"options":{"DefaultSSHPort":"22"}},"AWSEBAWSRegionArch2AMI":{"sa-east-1":{"64":"ami-1e08d103"},"ap-northeast-1":{"64":"ami-4e6cd34f"},"eu-west-1":{"64cg":"ami-1b02026f","64":"ami-c37474b7","64cc":"ami-d97474ad"},"us-east-1":{"64cg":"ami-02f54a6b","64":"ami-1624987f","64cc":"ami-08249861"},"us-west-1":{"64":"ami-1bf9de5e"},"us-west-2":{"64":"ami-2a31bf1a","64cc":"ami-2431bf14"},"ap-southeast-2":{"64":"ami-bd990e87"},"ap-southeast-1":{"64":"ami-a6a7e7f4"}},"AWSEBAWSInstanceType2Arch":{"m2.xlarge":{"Arch":"64"},"cg1.4xlarge":{"Arch":"64cg"},"m1.large":{"Arch":"64"},"m1.xlarge":{"Arch":"64"},"m2.2xlarge":{"Arch":"64"},"m1.medium":{"Arch":"64"},"m2.4xlarge":{"Arch":"64"},"cc2.8xlarge":{"Arch":"64cc"},"t1.micro":{"Arch":"64"},"m1.small":{"Arch":"64"},"cc1.4xlarge":{"Arch":"64cc"},"c1.medium":{"Arch":"64"},"c1.xlarge":{"Arch":"64"}}},"AWSTemplateFormatVersion":"2010-09-09","Resources":{"AWSEBAutoScalingLaunchConfiguration":{"Type":"AWS::AutoScaling::LaunchConfiguration","Properties":{"ImageId":{"Fn::FindInMap":["AWSEBAWSRegionArch2AMI",{"Ref":"AWS::Region"},{"Fn::FindInMap":["AWSEBAWSInstanceType2Arch",{"Ref":"InstanceType"},"Arch"]}]},"InstanceMonitoring":false,"SecurityGroups":[{"Ref":"AWSEBSecurityGroup"}],"InstanceType":{"Ref":"InstanceType"}}},"AWSEBLoadBalancer":{"Type":"AWS::ElasticLoadBalancing::LoadBalancer","Properties":{"AvailabilityZones":{"Fn::GetAZs":""},"Listeners":[],"HealthCheck":{"Timeout":"5","Target":"TCP:80","Interval":"30","HealthyThreshold":"3","UnhealthyThreshold":"5"}}},"AWSEBAutoScalingGroup":{"Type":"AWS::AutoScaling::AutoScalingGroup","Properties":{"Tags":[],"LoadBalancerNames":[{"Ref":"AWSEBLoadBalancer"}],"AvailabilityZones":{"Fn::GetAZs":""},"MaxSize":"4","Cooldown":"360","MinSize":"1","LaunchConfigurationName":{"Ref":"AWSEBAutoScalingLaunchConfiguration"}}},"AWSEBSecurityGroup":{"Type":"AWS::EC2::SecurityGroup","Properties":{"SecurityGroupIngress":[],"GroupDescription":"SecurityGroup for ElasticBeanstalk environment."}},"AWSEBCloudwatchAlarmLow":{"Type":"AWS::CloudWatch::Alarm","Properties":{"Period":"300","AlarmActions":[{"Ref":"AWSEBAutoScalingScaleDownPolicy"}],"Statistic":"Average","MetricName":"NetworkOut","Threshold":"2000000","EvaluationPeriods":"1","Dimensions":[{"Name":"AutoScalingGroupName","Value":{"Ref":"AWSEBAutoScalingGroup"}}],"AlarmDescription":"ElasticBeanstalk Default Scale Down alarm","Namespace":"AWS\/EC2","ComparisonOperator":"LessThanThreshold"}},"AWSEBCloudwatchAlarmHigh":{"Type":"AWS::CloudWatch::Alarm","Properties":{"Period":"300","AlarmActions":[{"Ref":"AWSEBAutoScalingScaleUpPolicy"}],"Statistic":"Average","MetricName":"NetworkOut","Threshold":"6000000","EvaluationPeriods":"1","Dimensions":[{"Name":"AutoScalingGroupName","Value":{"Ref":"AWSEBAutoScalingGroup"}}],"AlarmDescription":"ElasticBeanstalk Default Scale Up alarm","Namespace":"AWS\/EC2","ComparisonOperator":"GreaterThanThreshold"}},"AWSEBAutoScalingScaleDownPolicy":{"Type":"AWS::AutoScaling::ScalingPolicy","Properties":{"AutoScalingGroupName":{"Ref":"AWSEBAutoScalingGroup"},"ScalingAdjustment":"-1","AdjustmentType":"ChangeInCapacity"}},"AWSEBAutoScalingScaleUpPolicy":{"Type":"AWS::AutoScaling::ScalingPolicy","Properties":{"AutoScalingGroupName":{"Ref":"AWSEBAutoScalingGroup"},"ScalingAdjustment":"1","AdjustmentType":"ChangeInCapacity"}}}}},"PackMetadata":{"Name":"original ankit config","Description":"this is the original config which was made by ankit","DateCreated":"2013-02-28T19:38:21","DateUpdated":"2013-02-28T19:38:21"},"RuntimeSources":{},"OptionSettings":[{"Source":null,"OptionValue":"ucanapply123","Namespace":"aws:rds:dbinstance","ResourceName":null,"OptionName":"DBPassword"},{"Source":null,"OptionValue":"root","Namespace":"aws:rds:dbinstance","ResourceName":null,"OptionName":"DBUser"},{"Source":null,"OptionValue":"","Namespace":"aws:elasticbeanstalk:application","ResourceName":null,"OptionName":"Application Healthcheck URL"},{"Source":null,"OptionValue":"ankit@hexaviewtech.com","Namespace":"aws:elasticbeanstalk:sns:topics","ResourceName":null,"OptionName":"Notification Endpoint"},{"Source":null,"OptionValue":"t1.micro","Namespace":"aws:autoscaling:launchconfiguration","ResourceName":null,"OptionName":"InstanceType"},{"Source":null,"OptionValue":"70","Namespace":"aws:rds:dbinstance","ResourceName":null,"OptionName":"DBAllocatedStorage"},{"Source":null,"OptionValue":"Snapshot","Namespace":"aws:rds:dbinstance","ResourceName":null,"OptionName":"DBDeletionPolicy"},{"Source":null,"OptionValue":false,"Namespace":"aws:rds:dbinstance","ResourceName":null,"OptionName":"MultiAZDatabase"},{"Source":null,"OptionValue":"db.t1.micro","Namespace":"aws:rds:dbinstance","ResourceName":null,"OptionName":"DBInstanceClass"},{"Source":null,"OptionValue":"mysql","Namespace":"aws:rds:dbinstance","ResourceName":null,"OptionName":"DBEngine"},{"Source":null,"OptionValue":"ucanapplykeypair","Namespace":"aws:autoscaling:launchconfiguration","ResourceName":null,"OptionName":"EC2KeyName"}]}